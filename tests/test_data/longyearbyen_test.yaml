parameters:
  time_delta_minutes: 60 # minutes per timestep
  planning_horizon: 240 # timesteps in each rolling optimisation
  optimisation_timesteps: 24 # timesteps between each optimisation
  forecast_timesteps: 24 # timesteps beyond which forecast (instead of nowcast) profile is used
  time_reserve_minutes: 1440 # minutes, how long stored energy must be sustained to count as reserve
  co2_tax: 0.8 # NOK/kgCO2
  emission_intensity_max: -1 # kgCO2/Sm3oe, -1=no limit
  emission_rate_max: -1 # kgCO2/hour, -1=no limit
  max_pressure_deviation: -1 # global limit for allowable relative pressure deviation from nominal
  objective: costs # select objective function to use

carriers:
  - id: el
    powerflow_method: transport # transport, None, dc-pf
    el_backup_margin: -1 # MW, -1=no limit
    el_reserve_margin: 5 # MWm -1=no limit
  - id: heat
  - id: hydrogen
    energy_value: 13 # MJ/Sm3 - see https://www.engineeringtoolbox.com/fuels-higher-calorific-values-d_169.html

devices:
  - id: wind
    flow_max: 30
    co2em: 0 # kgCO2/MWh_el
    op_cost: 0.003 # NOK/MJ (10 NOK/MWh = 0.003 NOK/MJ)
    include: 1
    model: source_el
    name: wind_farm
    node_id: wind_farm
    profile: V47

  - id: pv
    flow_max: 25
    co2em: 0 # kgCO2/MWh_el
    op_cost: 0.002 # NOK/MJ (10 NOK/MWh = 0.003 NOK/MJ)
    include: 1
    model: source_el
    name: pv
    node_id: powersupply
    profile: PV

  - id: loadshed
    # A "generator" to cover otherwise unmet el demand - representing load shed
    include: 0
    model: source_el
    node_id: powersupply
    name: Loadshedding (dummy)
    flow_max: 1000
    # high operating (energy) cost to avoid using it unless necessary
    op_cost: 10 # NOK/MJ (= 10*3600s/h NOK/MWs = 36000 NOK/MWh)
    co2em: 0
    reserve_factor: 0 #does not contribute towards reserve

  - id: el_load
    flow_max: 1
    flow_min: 1
    include: 1
    model: sink_el
    name: general el load
    node_id: load
    reserve_factor: 0
    profile: el_load

  - id: heat_load
    flow_max: 1
    flow_min: 1
    include: 1
    model: sink_heat
    name: heat demand
    node_id: load
    profile: heat_load

  - id: electrolyser
    include: 1
    model: electrolyser
    name: electrolyser
    node_id: h2_storage
    flow_max: 60 # MW el
    eta: 0.64 #efficiency (el to h2)
    eta_heat: 0.17 # heat recovery ratio
    reserve_factor: 1 #contributes to spinning reserve
    op_cost: -0.02 #NOK/MJ (same as fuel cell - to give incentinve to fill storage)

  - id: fuelcell
    include: 1
    model: fuelcell
    name: fuelcell
    node_id: h2_storage
    flow_max: 45 # MW el
    eta: 0.50 #efficiency (h2 to el)
    eta_heat: 0.4 #heat recovery ratio
    op_cost: 0.03 # NOK/MJ (100 NOK/MWh = 0.03 NOK/MJ) #higher than wind, to favour wind when possible
    reserve_factor: 1 #contributes to spinning reserve

  - id: h2_storage
    include: 1
    model: storage_hydrogen
    name: h2_storage
    node_id: h2_storage
    E_max: 10000000 # Sm3  # 130 MJ/Sm3 => 36110 MWh (around 40 days at 40 MW)
    E_init: 5000000
    eta: 1
    #target_profile: h2target # "H2target", for planning beyond optimisation window
    #target_value: 500000 # Sm3, same as E_init
    #E_cost: 0.001 # NOK/Sm3 deviation at end of optimization horizon
    # 100 EUR/MWh = 1000 kr/MWh = 1 kr/kWh = 1/3.6 kr/MJ = 0.277 kr/MJ = 0.2777/13 kr/Sm3 = 0.021 kr/Sm3H2
    # gas 4.19 NOK/Sm3 = 4.14/40 kr/MJ = 0.1035*3600 kr/MWh = 372.6 kr/MWh (selling price = cost for gas)
    # -with efficiency 0.3 this becomes about 1000 kr/MWh_el
    # reasonable that storage cost is e.g. 1/10 of cost for gas turbines

  - id: el_storage
    flow_max: 6 # MW
    include: 1
    model: storage_el
    name: el_storage
    node_id: powersupply
    E_max: 7 # MWh
    E_init: 3 # MWh

  - id: heatpump
    include: 1
    model: heatpump
    name: heatpump
    node_id: heatpump
    flow_max: 20
    eta: 2
    op_cost: 0.01
  
  - id: heatdump
    flow_max: 100
    flow_min: 0
    include: 1
    model: sink_heat
    name: heat dump
    node_id: load

edges:
  - id: el_wf_ps
    flow_max: 500.0
    include: 1
    length_km: 60.0
    node_from: wind_farm
    node_to: powersupply
    reactance: 0.01
    resistance: 0.001
    carrier: el

  - id: el_ps_load
    flow_max: 500.0
    include: 1
    length_km: 3
    node_from: powersupply
    node_to: load
    reactance: 0.01
    resistance: 0.001
    carrier: el

  - id: heat_h2_load
    flow_max: 500.0
    include: 1
    length_km: 3
    node_from: h2_storage
    node_to: load
    carrier: heat
    
  - id: el_ps_h2
    include: 1
    node_from: powersupply
    node_to: h2_storage
    carrier: el
  
  - id: el_ps_hp
    include: 1
    node_from: powersupply
    node_to: heatpump
    carrier: el

  - id: heat_hp_load
    include: 1
    node_from: heatpump
    node_to: load
    carrier: heat

nodes:
  - id: wind_farm
  - id: powersupply
  - id: load
  - id: h2_storage
  - id: heatpump
